<template>
  <v-btn
    v-if="updateFound"
    small
    dark
    color="secondary"
    class="glow-anim"
    style="z-index:999!important"
    @click="updateClick"
  >
    <v-icon left small>
      cloud_download
    </v-icon>
    {{ updateText }}
  </v-btn>
  <v-btn v-else dark outlined small :disabled="checking" @click="checkUpdates">
    <v-icon left small :class="{ 'spin-anim': checking }">
      Сонхронизировать
    </v-icon>
    {{ checking ? 'Проверяю обновления...' : 'Проверить обновления' }}
  </v-btn>
</template>

<script lang="ts">
/* eslint-disable @typescript-eslint/explicit-function-return-type */
import Vue from 'vue'
import Component from 'vue-class-component'
import updateChecker from '@/util/UpdateChecker'

@Component
export default class UpdatesTracker extends Vue {
  updateFound = false
  checking = false
  async checkUpdates() {
    this.checking = true

    await updateChecker.checkUpdates()

    this.checking = false
  }

  created() {
    updateChecker.on('updatefound', () => (this.updateFound = true))
  }

  mounted() {
    if (updateChecker.updateAvailable) this.updateFound = true
  }

  get updateText(): string {
    return 'Обновить и Перезагрузить'
  }
  updateClick() {
    updateChecker.getUpdate()
  }
}
</script>

<style>
.spin-anim {
  animation-name: spin;
  animation-duration: 1.25s;
  animation-timing-function: cubic-bezier(0.455, 0.03, 0.515, 0.955);
  animation-iteration-count: infinite;
}

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(-360deg);
  }
}

.glow-anim {
  animation-name: glow;
  animation-duration: 1.2s;
  animation-timing-function: ease;
  animation-iteration-count: infinite;
}

@keyframes glow {
  from {
    box-shadow: 0px 0px 0px 0px rgba(245, 245, 245, 1);
  }
  to {
    box-shadow: 0px 0px 0px 8px rgba(245, 245, 245, 0);
  }
}
</style>
