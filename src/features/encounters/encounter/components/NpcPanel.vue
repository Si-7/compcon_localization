<template>
  <cc-titled-panel
    :icon="npc.Class.RoleIcon"
    :title="`${npc.Name}  —  ${typeof npc.Tier === 'number' ? `T${npc.Tier}` : `Пользовательский`} ${
      npc.Class.Name
    } ${npc.Templates.map(t => t.Name).join(' ')} ${npc.Tag}`"
    :color="npc.Class.Color"
    dense
  >
    <v-row dense class="mt-n1">
      <v-col v-if="npc.Campaign" cols="auto">
        <div class="overline">КАМПАНИЯ</div>
        {{ npc.Campaign }}
      </v-col>
      <v-col v-if="npc.Labels.length">
        <div class="overline">ЯРЛЫКИ</div>
        <v-chip v-for="l in npc.Labels" :key="l" small class="mx-1">{{ l }}</v-chip>
      </v-col>
      <v-col>
        <v-select
          v-if="sideSelect"
          v-model="npc.Side"
          label="Сторона"
          outlined
          dense
          hide-details
          :items="['Противник', 'Союзник', 'Нейтральный']"
        />
      </v-col>
    </v-row>
    <v-textarea
      v-if="sideSelect"
      v-model="npc.Note"
      outlined
      label="GM Notes"
      auto-grow
      rows="2"
      class="mt-3"
    />
    <p v-else-if="npc.Note" v-html-safe="npc.Note" class="flavor-text mb-0" />

    <v-row dense class="text-center" align="center">
      <v-col cols="7">
        <v-row dense no-gutters>
          <simple-attribute attr="КРП" :val="npc.Stats.Hull" />
          <simple-attribute attr="МНВР" :val="npc.Stats.Agility" />
          <simple-attribute attr="СИС" :val="npc.Stats.Systems" />
          <simple-attribute attr="ИНЖ" :val="npc.Stats.Engineering" />
        </v-row>
        <v-divider class="my-2" />
        <v-row dense no-gutters>
          <simple-attribute attr="СТРУКТУРА" :val="npc.Stats.Structure" />
          <simple-attribute attr="БРОНЯ" :val="npc.Stats.Armor" />
          <simple-attribute attr="ПЗ" :val="npc.Stats.HP" />
          <simple-attribute attr="НАГРУЗКА" :val="npc.Stats.Stress" />
          <simple-attribute
            attr="ТЕПЛ. МАКС."
            :val="npc.Stats.HeatCapacity"
            :color="npc.Class.Color"
          />
        </v-row>
        <v-divider class="my-2" />
        <v-row dense no-gutters>
          <simple-attribute attr="СКОРОСТЬ" :val="npc.Stats.Speed" />
          <simple-attribute attr="СПАСБРОСОК" :val="npc.Stats.Save" />
          <simple-attribute attr="УКЛОНЕНИЕ" :val="npc.Stats.Evade" />
          <simple-attribute attr="Э-ЗАЩ" :val="npc.Stats.EDefense" />
          <simple-attribute attr="СЕНСОРЫ" :val="npc.Stats.Sensor" />
        </v-row>
        <v-divider class="my-2" />
        <v-row dense no-gutters>
          <simple-attribute
            attr="АКТИВАЦИИ"
            :val="npc.Stats.Activations"
            :color="npc.Class.Color"
          />
          <simple-attribute attr="РАЗМЕР" :val="npc.Stats.Size" />
        </v-row>
      </v-col>
      <v-divider vertical />
      <v-col>
        <div>
          <v-icon v-if="npc.Tier === 'custom'" size="40" :color="npc.Class.Color">
            mdi-star-circle-outline
          </v-icon>
          <v-icon v-else size="40" :color="npc.Class.Color">cci-rank-{{ npc.Tier }}</v-icon>
          <div v-if="npc.Tier === 'custom'" class="overline mt-n1">ПОЛЬЗОВАТЕЛЬСКАЯ</div>
          <div v-else class="overline mt-n1">ГРАДАЦИЯ {{ npc.Tier }}</div>
        </div>
        <v-divider class="my-1" />
        <div>
          <v-icon size="40" :color="npc.Class.Color">{{ npc.Class.RoleIcon }}</v-icon>
          <div class="overline mt-n1">{{ npc.Class.Role }}</div>
        </div>
        <v-divider class="my-1" />
      </v-col>
      <v-divider vertical />
      <v-col cols="3">
        <v-img
          v-if="npc.PortraitController.Image"
          :key="npc.PortraitController.Image"
          :src="npc.PortraitController.Image"
          aspect-ratio="1"
        />
      </v-col>
    </v-row>
    <v-row dense no-gutters class="my-2">
      <v-col cols="2"><v-divider class="mt-3" /></v-col>
      <span class="heading h3 accent--text px-2">СИСТЕМЫ</span>
      <v-col><v-divider class="mt-3" /></v-col>
    </v-row>
    <v-row dense class="mr-2 mt-n1 ml-2">
      <v-col v-for="(item, j) in npc.Items" :key="`${npc.ID}_${item.Name}_${j}`" cols="auto">
        <cc-dialog no-confirm small-btn :color="item.Feature.Color" large>
          <span slot="button" class="white--text" style="width: 100%">
            <v-icon left dark>{{ item.Feature.Icon }}</v-icon>
            {{ item.Name }}
          </span>

          <span slot="title">
            <v-icon left large dark>{{ item.Feature.Icon }}</v-icon>
            {{ item.Name }}
          </span>
          <v-chip slot="title-items" color="white" class="stat-text mt-4 mr-6" outlined label>
            {{ item.Feature.FeatureType }}
          </v-chip>

          <cc-item-card :item="item.Feature">
            <p slot="statblock" v-html-safe="item.Description" />
          </cc-item-card>
        </cc-dialog>
      </v-col>
    </v-row>
    <slot />
  </cc-titled-panel>
</template>

<script lang="ts">
import Vue from 'vue'
import SimpleAttribute from './SimpleAttribute.vue'

export default Vue.extend({
  name: 'npc-panel',
  components: { SimpleAttribute },
  props: {
    npc: {
      type: Object,
      required: true,
    },
    sideSelect: {
      type: Boolean,
    },
  },
})
</script>
