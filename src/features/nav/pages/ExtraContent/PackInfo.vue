<template>
  <v-card>
    <v-list-item class="primary" style="flex-grow: 0; flex-basis: auto;">
      <v-list-item-icon>
        <v-icon dark x-large>mdi-package</v-icon>
      </v-list-item-icon>
      <v-list-item-content>
        <v-list-item-title class="headline white--text">
          {{ pack.manifest.name }}
          <v-chip outlined dark label>{{ pack.manifest.version }}</v-chip>
        </v-list-item-title>
        <v-list-item-subtitle class="white--text text--darken-1">
          от {{ pack.manifest.author }}
        </v-list-item-subtitle>
      </v-list-item-content>
    </v-list-item>
    <v-card-text>
      <v-row>
        <v-col>
          <p class="body-text text--text light-panel pa-2 mb-1">
            <span v-if="pack.manifest.description" v-html-safe="pack.manifest.description" />
            <span v-else>
              Нет описания.
            </span>
          </p>
          <div>
            <h4>Содержимое</h4>
            <div>
              <v-chip
                v-for="item in packContents"
                :key="item.name"
                outlined
                color="secondary"
                class="mr-2 mb-1 caption"
              >
                <v-avatar class="secondary white--text" left>
                  <b>{{ item.count }}</b>
                </v-avatar>
                {{ item.name }}
              </v-chip>
            </div>
          </div>
          <div v-if="pack.manifest.website" class="mt-2">
            <v-divider class="ma-1" />
            <v-btn target="_blank" :href="pack.manifest.website" text color="secondary">
              <v-icon prepend class="mr-1">open_in_new</v-icon>
              &nbsp;Сайт
            </v-btn>
          </div>
        </v-col>
        <v-col cols="12" md="4">
          <v-img
            :src="pack.manifest.image_url"
            alt="Pack image"
            max-width="200px"
            max-height="300px"
          />
        </v-col>
      </v-row>
    </v-card-text>
  </v-card>
</template>

<script lang="ts">
import Vue from 'vue'
import Component from 'vue-class-component'
import _ from 'lodash'

@Component({
  props: {
    pack: { type: Object, required: true },
  },
})
export default class PackInfo extends Vue {
  private humanReadableMap = {
    manufacturers: ['manufacturer', 'производителей'],
    coreBonuses: ['core bonus', 'бонусов ядра'],
    frames: ['frame', 'рам'],
    weapons: ['weapon', 'оружия'],
    systems: ['system', 'систем'],
    mods: ['weapon mod', 'модов оружия'],
    pilotGear: ['pilot gear item', 'снаряжения пилота'],
    backgrounds: ['background', 'предысторий'],
    bonds: ['bond', 'связей'],
    reserves: ['reserve', 'резервов'],
    talents: ['pilot talent', 'талантов пилота'],
    tags: ['equipment tag', 'меток снаряжения'],
    npcClasses: ['NPC class', 'классов НИП'],
    npcFeatures: ['NPC feature', 'систем НИП'],
    npcTemplates: ['NPC template', 'шаблонов НИП'],
    actions: ['Player action', 'действий игрока'],
    statuses: ['Status/Condition', 'Статусов/Состояний'],
    environments: ['Combat Environment', 'Боевых Окружений'],
    factions: ['faction', 'фракций'],
    sitreps: ['SITREP', 'СИТРЕПов'],
    tables: ['Data Table', 'таблиц данных'],
  }

  get packContents() {
    return _.toPairs(this.$props.pack.data)
      .map(([key, value]: [string, object[]]) => {
        const count = value.length
        return [key, count]
      })
      .filter(([, count]) => count > 0)
      .map(([key, count]) => {
        const pair = this.humanReadableMap[key]
        if (!pair) return { count, name: `${key}--NOT--HUMANIZED` }
        const [singular, plural]: [string, string] = pair
        return { count, name: count > 1 ? plural : singular }
      })
  }
}
</script>

<style scoped>
.packImage {
  display: block;
  max-width: 100%;
  max-height: 200px;
  border-radius: 4px;
  margin: 0 auto;
}
</style>
