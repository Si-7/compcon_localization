<template>
  <cc-stepper-content
    :complete="canContinue()"
    :exit="`/pilot/${pilot.ID}`"
    back
    no-confirm
    @back="$emit('back')"
  >
    <pilot-registration-card :pilot="pilot" :pilot-ready="pilotReady" />
    <br />
    <v-alert type="error" outlined :value="!pilotReady">
      <span class="stat-text accent--text">
        ВНИМАНИЕ: Запрос на IDENT запись {{ pilot.ID }} имеет следующую(ие) проблему(ы):
      </span>
      <ul class="flavor-text error--text">
        <li v-if="!pilot.Callsign">Позывной пилота пуст или неверный</li>
        <li v-if="!pilot.Name">Имя пилота пусто или неверно</li>
        <li v-if="!pilot.SkillsController.HasFullSkills">
          Триггеры пилота неполны или неверны
        </li>
        <li v-if="!pilot.TalentsController.HasFullTalents">PILOT TALENTS incomplete or invalid</li>
        <li v-if="!pilot.MechSkillsController.HasFullHASE">
          Навыки Мехов пилота неполны или неверны
        </li>
        <li v-if="!pilot.LicenseController.HasLicenses">Лицензии пилота неполны или неверны</li>
        <li v-if="!pilot.CoreBonusController.HasCBs">Бонусы Ядра пилота неполны или неверны</li>
      </ul>
    </v-alert>
    <v-btn x-large block color="secondary" tile class="mx-2 my-8" @click="savePilot()">
      ОБНОВИТЬ ЗАПИСЬ ПИЛОТА // {{ pilot.Callsign }} ({{ pilot.Name }})
    </v-btn>
  </cc-stepper-content>
</template>

<script lang="ts">
import Vue from 'vue'
import { Pilot } from '@/class'
import PilotRegistrationCard from '../../PilotSheet/components/PilotRegistrationCard.vue'

export default Vue.extend({
  name: 'confirm-page',
  components: { PilotRegistrationCard },
  props: {
    pilot: {
      type: Object,
      required: true,
    },
    original: {
      type: Object,
      required: true,
    },
  },
  computed: {
    pilotReady(): boolean {
      return (
        this.pilot.HasIdent &&
        this.pilot.SkillsController.HasFullSkills &&
        this.pilot.TalentsController.HasFullTalents &&
        this.pilot.MechSkillsController.HasFullHASE
      )
    },
  },
  methods: {
    savePilot() {
      this.original.ApplyLevel(Pilot.Serialize(this.pilot))
      this.$router.push({ name: 'pilot_sheet', params: { id: this.pilot.ID } })
    },
    canContinue() {
      return (
        this.pilot.Callsign &&
        this.pilot.Name &&
        this.pilot.SkillsController.HasFullSkills &&
        this.pilot.TalentsController.HasFullTalents &&
        this.pilot.MechSkillsController.HasFullHASE &&
        this.pilot.LicenseController.HasLicenses &&
        this.pilot.CoreBonusController.HasCBs
      )
    },
  },
})
</script>
